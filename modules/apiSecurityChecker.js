const axios = require('axios');
const fs = require('fs');

// Fonction pour vérifier les vulnérabilités d'injection de paramètres d'API
async function checkAPIVulnerabilities(targetAPI, outputFilePath) {
  try {
    // Liste des paramètres d'API vulnérables
    const vulnerableParameters = ['user', 'id', 'query', 'param', 'input'];

    // Parcours des paramètres d'API vulnérables
    for (const parameter of vulnerableParameters) {
      const testURL = `${targetAPI}?${parameter}=<injection>`;
      const response = await axios.get(testURL);

      if (response.data.includes('<injection>')) {
        const report = `Vulnérabilité d'injection détectée : Paramètre '${parameter}' dans l'API ${targetAPI}\n`;
        fs.appendFileSync(outputFilePath, report);
        console.log(report);
      }
    }

    console.log('Vérification des vulnérabilités d\'injection terminée.');
  } catch (error) {
    console.error('Erreur lors de la vérification des vulnérabilités d\'injection :', error);
    const report = `Erreur lors de la vérification des vulnérabilités d'injection : ${error}\n`;
    fs.appendFileSync(outputFilePath, report);
  }
}

module.exports = {
  checkAPIVulnerabilities,
};
