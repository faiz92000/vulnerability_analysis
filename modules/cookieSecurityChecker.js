const axios = require('axios');
const fs = require('fs');

// Fonction pour vérifier la gestion des cookies
async function checkCookieManagement(targetUrl, outputFilePath) {
  try {
    // Envoyer une requête avec un cookie de session sécurisé
    const secureCookie = 'session=secure; HttpOnly; Secure'; // Exemple de cookie sécurisé

    const response = await axios.get(targetUrl, { headers: { 'Cookie': secureCookie } });

    if (response.status === 200) {
      const report = `La gestion des cookies semble sécurisée pour ${targetUrl}.\n`;
      fs.appendFileSync(outputFilePath, report);
      console.log(report);
    } else {
      const errorReport = `Vulnérabilité potentielle : la gestion des cookies pour ${targetUrl} est problématique.\n`;
      fs.appendFileSync(outputFilePath, errorReport);
      console.error(errorReport);
    }

    console.log('Vérification de la gestion des cookies terminée.');
  } catch (error) {
    console.error('Erreur lors de la vérification de la gestion des cookies :', error);
    const report = `Erreur lors de la vérification de la gestion des cookies : ${error}\n`;
    fs.appendFileSync(outputFilePath, report);
  }
}

module.exports = {
  checkCookieManagement,
};
