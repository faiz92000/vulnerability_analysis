const axios = require('axios');
const fs = require('fs');

// Fonction pour identifier les vulnérabilités de sécurité CORS
async function identifyCORSVulnerabilities(targetOrigin, outputFilePath) {
  try {
    // Envoyer une requête avec l'en-tête CORS personnalisé
    const customHeader = {
      headers: { 'Origin': 'https://malicious-website.com' }, // Remplacez par le site malveillant
    };

    const response = await axios.get(targetOrigin, customHeader);

    if (response.headers['access-control-allow-origin'] !== targetOrigin) {
      const report = `Vulnérabilité CORS détectée : ${targetOrigin} n'applique pas de politique CORS correcte.\n`;
      fs.appendFileSync(outputFilePath, report);
      console.log(report);
    } else {
      console.log('Aucune vulnérabilité CORS détectée :', targetOrigin);
    }

    console.log('Analyse de la sécurité CORS terminée.');
  } catch (error) {
    console.error('Erreur lors de l'analyse de la sécurité CORS :', error);
    const report = `Erreur lors de l'analyse de la sécurité CORS : ${error}\n`;
    fs.appendFileSync(outputFilePath, report);
  }
}

module.exports = {
  identifyCORSVulnerabilities,
};
