const axios = require('axios');
const fs = require('fs');
const path = require('path');

// Liste des fichiers sensibles à vérifier
const sensitiveFiles = [
  '/config/config.json',
  '/logs/access.log',
  '/data/userdata.txt',
  // Ajoutez d'autres fichiers sensibles à vérifier
];

async function checkSensitiveFiles(url, outputFilePath) {
  try {
    const exposedFiles = [];

    for (const filePath of sensitiveFiles) {
      const fileUrl = new URL(filePath, url).toString();

      const response = await axios.get(fileUrl);

      if (response.status === 200) {
        exposedFiles.push(fileUrl);
      }
    }

    if (exposedFiles.length > 0) {
      console.log('Fichiers sensibles exposés :');
      const report = 'Fichiers sensibles exposés :\n';

      for (const fileUrl of exposedFiles) {
        console.log(fileUrl);
        report += `${fileUrl}\n`;
      }

      fs.appendFileSync(outputFilePath, report);
    } else {
      console.log('Aucun fichier sensible exposé.');
    }
  } catch (error) {
    console.error('Erreur lors de la vérification des fichiers sensibles :', error);
    const report = `Erreur lors de la vérification des fichiers sensibles : ${error}\n`;
    fs.appendFileSync(outputFilePath, report);
  }
}

module.exports = {
  checkSensitiveFiles,
};
