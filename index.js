const fs = require('fs');
const apiSecurityChecker = require('./modules/apiSecurityChecker');
const corsSecurityAnalyzer = require('./modules/corsSecurityAnalyzer');
const cookieSecurityChecker = require('./modules/cookieSecurityChecker');
const ldapInjectionVulnerabilityDetector = require('./modules/ldapInjectionVulnerabilityDetector');
const xmlInjectionDetector = require('./modules/xmlInjectionDetector');
const xssVulnerabilityScanner = require('./modules/xssVulnerabilityScanner');

// Fonction pour exécuter toutes les vérifications de sécurité
async function runSecurityChecks(targetUrl) {
  try {
    const outputFilePath = 'security_report.txt';
    fs.writeFileSync(outputFilePath, ''); // Efface le rapport précédent

    // Vérification de la sécurité de l'API
    await apiSecurityChecker.checkAPIVulnerabilities(targetUrl, outputFilePath);

    // Analyse de la sécurité CORS
    await corsSecurityAnalyzer.identifyCORSVulnerabilities(targetUrl, outputFilePath);

    // Vérification de la gestion des cookies
    await cookieSecurityChecker.checkCookieManagement(targetUrl, outputFilePath);

    // Détection des vulnérabilités d'injection LDAP
    await ldapInjectionVulnerabilityDetector.detectLDAPInjectionVulnerabilities(targetUrl, outputFilePath);

    // Détection des vulnérabilités d'injection XML
    const payload = `
    <!DOCTYPE foo [  
      <!ELEMENT foo ANY >
      <!ENTITY xxe SYSTEM "file:///etc/passwd" >]>
    <foo>&xxe;</foo>
    `;
    await xmlInjectionDetector.detectXMLInjectionVulnerabilities(targetUrl, payload, outputFilePath);

    // Analyse des vulnérabilités XSS
    await xssVulnerabilityScanner.scanXSSVulnerabilities(targetUrl, outputFilePath);

    console.log('Toutes les vérifications de sécurité sont terminées. Le rapport a été enregistré dans', outputFilePath);
  } catch (error) {
    console.error('Une erreur s\'est produite lors de l\'exécution des vérifications de sécurité :', error);
  }
}

// Exécution des vérifications de sécurité pour une URL cible
const targetUrl = 'https://example.com'; // Remplacez par votre URL cible
runSecurityChecks(targetUrl);
